/**
 * Centralized Webflow to Calendly Integration (Minified)
 * @version 1.0.0
 */
(function(){
  'use strict';
  
  // CONFIGURATION - Edit these values
  const CALENDLY_URL="hhttps://calendly.com/vivek-wisemonk/";
  const DEBUG=false;
  const EXCLUDE_FORM_ATTRIBUTE="data-no-calendly";
  
  function init(){
    const a=document.querySelectorAll('form');
    if(!a.length){DEBUG&&console.log('No forms found.');return}
    const b=Array.from(a).filter(f=>f.getAttribute(EXCLUDE_FORM_ATTRIBUTE)!=='true');
    DEBUG&&console.log(`Found ${b.length} forms to process (out of ${a.length} total).`);
    b.forEach((f,i)=>{
      DEBUG&&console.log(`Processing form #${i+1}`);
      f.addEventListener('submit',function(){
        setTimeout(()=>{
          const e=f.querySelectorAll('input,textarea,select');
          let em='',n='',m='';
          e.forEach(el=>{
            const en=el.name?el.name.toLowerCase():'';
            const ei=el.id?el.id.toLowerCase():'';
            const ep=el.placeholder?el.placeholder.toLowerCase():'';
            const et=el.type?el.type.toLowerCase():'';
            const v=el.value.trim();
            if(!v)return;
            if(et==='email'||en.includes('email')||ei.includes('email')||ep.includes('email')){
              em=v;
              DEBUG&&console.log('Found email:',em);
            }else if((en.includes('name')||ei.includes('name')||ep.includes('name'))&&
                    !en.includes('last')&&!ei.includes('last')&&
                    !en.includes('company')&&!ei.includes('company')){
              n=v;
              DEBUG&&console.log('Found name:',n);
            }else if(el.tagName==='TEXTAREA'||
                   en.includes('message')||en.includes('comment')||
                   ei.includes('message')||ei.includes('comment')||
                   ep.includes('message')||ep.includes('comment')){
              m=v;
              DEBUG&&console.log('Found message:',m);
            }
          });
          if(em){
            let u=CALENDLY_URL;
            const p=[];
            p.push(`email=${encodeURIComponent(em)}`);
            if(n)p.push(`name=${encodeURIComponent(n)}`);
            if(m)p.push(`a1=${encodeURIComponent(m)}`);
            u+=(u.includes('?')?'&':'?')+p.join('&');
            DEBUG&&console.log(`Redirecting to: ${u}`);
            window.location.href=u;
          }else{
            DEBUG&&console.log('No email found. Skipping redirect.');
          }
        },500);
      });
    });
  }
  
  if(document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded',init);
  }else{
    init();
  }
})();
